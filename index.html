<!DOCTYPE html>
<html lang="tr">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9YQEJ7LN0E"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-9YQEJ7LN0E');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Leap: Boss Mode</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        body {
            margin: 0; overflow: hidden;
            background-color: #020204; color: white;
            font-family: 'Orbitron', sans-serif;
            touch-action: none; user-select: none; -webkit-user-select: none;
            transition: background-color 2s ease;
        }
        canvas { display: block; width: 100%; height: 100%; }

        /* EKRAN SARSINTISI EFEKTƒ∞ */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .shake-screen { animation: shake 0.5s; animation-iteration-count: infinite; }

        /* UI */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 20;
            display: flex; flex-direction: column; align-items: center;
        }

        .top-hud {
            position: absolute; top: 20px; width: 100%;
            display: grid; grid-template-columns: 1fr auto 1fr;
            align-items: center; padding: 0 20px; box-sizing: border-box;
            pointer-events: auto;
        }
        
        .hud-left { display: flex; align-items: center; gap: 10px; justify-self: start; }
        .hud-center { text-align: center; }
        .hud-right { justify-self: end; display: flex; gap: 15px; align-items: center; }

        .score-box { font-size: 3rem; font-weight: 900; transition: color 0.5s; line-height: 1; }
        .level-indicator { font-size: 0.7rem; color: rgba(255,255,255,0.5); letter-spacing: 2px; }

        .shield-container {
            display: flex; align-items: center; gap: 8px;
            color: #00ff9d; font-size: 1.1rem; font-weight: bold;
            background: rgba(0, 255, 157, 0.1);
            padding: 8px 16px; border-radius: 30px; border: 1px solid rgba(0, 255, 157, 0.3);
            transition: all 0.3s;
        }
        .shield-active { transform: scale(1.3); background: rgba(0, 255, 157, 0.6); box-shadow: 0 0 30px #00ff9d; color: #000; }

        .credits-box {
            color: #ffd700; font-size: 1rem; font-weight: bold;
            display: flex; align-items: center; gap: 5px;
            text-shadow: 0 0 5px #ffd700;
            background: rgba(255, 215, 0, 0.1);
            padding: 5px 10px; border-radius: 15px; border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .icon-btn {
            background: transparent; border: none; color: rgba(255,255,255,0.6);
            font-size: 1.8rem; cursor: pointer; transition: 0.2s; padding: 0;
        }
        .icon-btn:hover { color: white; transform: scale(1.2); }

        /* MEN√úLER */
        .menu-screen {
            pointer-events: auto; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(10, 15, 25, 0.95); padding: 2rem;
            border-radius: 20px; border: 1px solid rgba(0, 242, 255, 0.3);
            text-align: center; display: flex; flex-direction: column; gap: 1rem;
            box-shadow: 0 0 60px rgba(0,0,0,0.8); min-width: 320px; max-width: 90%;
            backdrop-filter: blur(15px); z-index: 50;
        }
        h1 { margin: 0; font-size: 2.5rem; background: linear-gradient(to right, #00f2ff, #00ff9d); -webkit-background-clip: text; color: transparent; }
        
        .btn {
            background: rgba(0, 242, 255, 0.1); border: 2px solid #00f2ff; color: #00f2ff;
            padding: 15px 30px; font-size: 1.1rem; font-family: inherit; font-weight: bold;
            cursor: pointer; border-radius: 50px; transition: 0.2s; width: 100%;
        }
        .btn:hover { background: #00f2ff; color: black; box-shadow: 0 0 20px #00f2ff; }
        .btn-share { border-color: #00ff9d; color: #00ff9d; background: rgba(0, 255, 157, 0.1); }
        .btn-share:hover { background: #00ff9d; color: black; }
        .btn-secondary { border-color: #666; color: #aaa; font-size: 0.8rem; padding: 8px 16px; width: auto; }
        .hidden { display: none !important; }

        /* SHOP STƒ∞LLERƒ∞ */
        .shop-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;
            max-height: 300px; overflow-y: auto; padding: 5px;
        }
        .shop-item {
            border: 1px solid #444; border-radius: 10px; padding: 10px;
            cursor: pointer; transition: 0.2s; position: relative;
            background: rgba(0,0,0,0.3);
        }
        .shop-item:hover { border-color: #fff; background: rgba(255,255,255,0.1); }
        .shop-item.selected { border-color: #00ff9d; box-shadow: 0 0 15px rgba(0,255,157,0.3); background: rgba(0, 255, 157, 0.05); }
        .shop-item-preview {
            width: 40px; height: 40px; margin: 0 auto 10px;
            display: flex; justify-content: center; align-items: center;
        }
        .preview-ship {
            width: 0; height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 25px solid white;
        }
        .shop-price { font-size: 0.9rem; color: #ffd700; font-weight: bold; }
        .shop-owned { font-size: 0.8rem; color: #aaa; }
        .shop-active-text { font-size: 0.8rem; color: #00ff9d; font-weight: bold; }

        .result-box {
            background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 15px;
            margin-bottom: 15px; border: 1px dashed rgba(255,255,255,0.2);
        }
        .emoji-strip {
            font-size: 1.5rem; letter-spacing: 3px; margin: 10px 0; word-break: break-all;
            line-height: 1.4; text-shadow: 0 0 10px rgba(255,255,255,0.3);
        }

        input[type="text"] {
            background: rgba(0,0,0,0.5); border: 2px solid #333; color: white;
            padding: 15px; font-family: 'Orbitron'; font-size: 1.2rem; text-align: center;
            border-radius: 10px; width: 80%; margin: 0 auto; outline: none;
        }

        .leaderboard-list { list-style: none; padding: 0; margin: 0; width: 100%; text-align: left; }
        .leaderboard-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #333; font-size: 0.9rem; }
        .leaderboard-item:nth-child(1) { color: #ffd700; font-weight: bold; text-shadow: 0 0 10px #ffd700; }
        .loading { color: #00f2ff; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        .floating-text {
            position: absolute; font-weight: 900; pointer-events: none;
            animation: floatUp 1.5s forwards; text-shadow: 0 0 10px black; white-space: nowrap; font-size: 1.5rem; z-index: 10;
        }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-120px) scale(1.5); opacity: 0; } }

        /* BOSS UYARISI */
        #boss-warning {
            position: absolute; top: 40%; width: 100%; text-align: center;
            font-size: 4rem; font-weight: 900; color: #ff0000;
            text-shadow: 0 0 30px red; opacity: 0; pointer-events: none;
            z-index: 15;
        }
        .boss-anim { animation: bossPulse 3s infinite; opacity: 1 !important; }
        @keyframes bossPulse { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 1; } }

        #level-up-msg {
            position: absolute; top: 35%; width: 100%; text-align: center;
            font-size: 3rem; font-weight: 900; color: #fff;
            text-shadow: 0 0 20px currentColor; opacity: 0; pointer-events: none; transition: color 0.5s;
        }
        .levelup-anim { animation: levelUpPop 2.5s forwards; }
        @keyframes levelUpPop {
            0% { opacity: 0; transform: scale(0.5) translateY(50px); }
            15% { opacity: 1; transform: scale(1.2) translateY(0); }
            85% { opacity: 1; transform: scale(1) translateY(0); }
            100% { opacity: 0; transform: scale(1.5) translateY(-50px); }
        }

        .audio-controls {
            position: absolute; bottom: 20px; right: 20px; pointer-events: auto;
            display: flex; gap: 15px; z-index: 30;
        }
        .audio-btn {
            background: transparent; border: none; font-size: 1.8rem; opacity: 0.7; cursor: pointer;
            transition: transform 0.2s; color: white;
        }
        .audio-btn:hover { opacity: 1; transform: scale(1.1); }
        .audio-off { opacity: 0.3; filter: grayscale(100%); }

        #toast {
            position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%);
            background: #00ff9d; color: black; padding: 10px 20px;
            border-radius: 20px; font-weight: bold; opacity: 0; pointer-events: none;
            transition: opacity 0.3s; z-index: 100;
        }
        .show-toast { opacity: 1 !important; bottom: 60px !important; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="top-hud">
            <div class="hud-left">
                <button id="pause-btn" class="icon-btn" title="Durdur">‚è∏Ô∏è</button>
                <div id="shield-ui" class="shield-container">
                    <span>üõ°Ô∏è</span> <span id="shield-count">0</span>
                </div>
            </div>

            <div class="hud-center">
                <div id="score" class="score-box">0</div>
                <div id="level-txt" class="level-indicator">SECTOR 1</div>
            </div>

            <div class="hud-right">
                <div class="credits-box">
                    <span id="total-credits">0</span> <span>üü°</span>
                </div>
                <button id="shop-btn" class="icon-btn" title="Market">üõí</button>
                <button id="show-leaderboard-btn" class="icon-btn" title="Lider Tablosu">üèÜ</button>
                <button id="fullscreen-btn" class="icon-btn" title="Tam Ekran">‚õ∂</button>
            </div>
        </div>

        <div id="level-up-msg">LEVEL UP!</div>
        <div id="boss-warning">‚ö†Ô∏è BOSS ‚ö†Ô∏è</div>

        <div id="pause-screen" class="menu-screen hidden">
            <h1>PAUSED</h1>
            <button class="btn" id="resume-btn">DEVAM ET</button>
            <button class="btn btn-secondary" id="quit-btn">√áIKI≈û</button>
        </div>

        <div id="start-screen" class="menu-screen">
            <h1>NEON LEAP</h1>
            <p style="color:#ccc; line-height: 1.6;">
                <span style="color:#ffaa00" data-i18n="start_subtitle_1">üî• HIZLI OYNA (Combo)</span><br>
                <span style="color:#00ff9d" data-i18n="start_subtitle_2">üõ°Ô∏è 3 COMBO = 1 JOKER</span>
            </p>
            <button class="btn" id="start-btn" data-i18n="btn_start">BA≈ûLAT</button>
        </div>

        <div id="shop-screen" class="menu-screen hidden">
            <h2 style="color:#ffd700;">MARKET</h2>
            <div class="credits-box" style="justify-content:center; margin-bottom:15px; background:none; border:none;">
                <span>BAKƒ∞YE:</span> <span id="shop-credits" style="font-size:1.5rem;">0</span> üü°
            </div>
            <div class="shop-grid" id="shop-grid"></div>
            <br>
            <button class="btn btn-secondary" id="close-shop-btn">KAPAT</button>
        </div>

        <div id="game-over-screen" class="menu-screen hidden">
            <h2 style="color:#ff0055; margin:0;" data-i18n="game_over_title">G√ñREV SONU</h2>
            
            <div class="result-box">
                <div style="font-size:0.8rem; color:#aaa; margin-bottom:5px;" data-i18n="mission_report">G√ñREV RAPORU</div>
                <div id="share-preview" class="emoji-strip">...</div>
                <div style="display:flex; justify-content:space-around; align-items:center; margin-top:5px;">
                    <div style="font-size:2rem; font-weight:bold;" id="final-score">0</div>
                    <div style="color:#666; font-size:0.8rem;"><span data-i18n="best_score">EN ƒ∞Yƒ∞:</span> <span id="best-score">0</span></div>
                </div>
            </div>

            <div style="display: flex; gap: 10px; width: 100%;">
                <button class="btn btn-share" id="share-btn" data-i18n="btn_share">üì§ PAYLA≈û</button>
            </div>
            
            <hr style="border:0; border-top:1px solid rgba(255,255,255,0.1); margin:15px 0; width:100%;">

            <div id="save-score-area">
                <p style="font-size:0.8rem; color:#aaa;" data-i18n="enter_name">Lƒ∞DER TABLOSU ƒ∞√áƒ∞N ADINI YAZ:</p>
                <input type="text" id="player-name" placeholder="Pƒ∞LOT ADI" maxlength="15">
                <br><br>
                <button class="btn" id="save-score-btn" style="border-color:#00f2ff; color:#00f2ff;" data-i18n="btn_save">KAYDET</button>
            </div>
            
            <div style="margin-top:15px;">
                <button class="btn" id="restart-btn" style="border-color:#666; color:#ccc;" data-i18n="btn_retry">TEKRAR DENE</button>
            </div>
        </div>

        <div id="leaderboard-screen" class="menu-screen hidden" style="z-index: 100;">
            <h2 style="color:#ffd700; margin-bottom: 10px;" data-i18n="leaderboard_title">üèÜ TOP 10 Pƒ∞LOT</h2>
            <div id="leaderboard-content" class="loading" data-i18n="loading">Y√ºkleniyor...</div>
            <br>
            <button class="btn btn-secondary" id="close-leaderboard-btn" data-i18n="btn_close">KAPAT</button>
        </div>
        
        <div class="audio-controls">
            <button id="sfx-btn" class="audio-btn" title="Ses Efektleri">üîä</button>
            <button id="music-btn" class="audio-btn" title="M√ºzik">üéµ</button>
        </div>
    </div>

    <div id="toast"></div>
    <textarea id="clipboard-helper" style="position:absolute; left:-9999px;"></textarea>
    <canvas id="gameCanvas"></canvas>

    <!-- Dƒ∞L -->
    <script>
        const TRANSLATIONS = {
            tr: {
                start_subtitle_1: "üî• HIZLI OYNA (Combo)",
                start_subtitle_2: "üõ°Ô∏è 3 COMBO = 1 JOKER",
                btn_start: "BA≈ûLAT",
                game_over_title: "G√ñREV SONU",
                mission_report: "G√ñREV RAPORU",
                best_score: "EN ƒ∞Yƒ∞:",
                btn_share: "üì§ PAYLA≈û",
                enter_name: "Lƒ∞DER TABLOSU ƒ∞√áƒ∞N ADINI YAZ:",
                placeholder_name: "Pƒ∞LOT ADI",
                btn_save: "KAYDET",
                btn_retry: "TEKRAR DENE",
                leaderboard_title: "üèÜ TOP 10 Pƒ∞LOT",
                btn_close: "KAPAT",
                level_up: "SEVƒ∞YE ATLADI!",
                combo_x: "SERƒ∞ x",
                combo_broken: "SERƒ∞ BOZULDU",
                shield_gained: "JOKER KAZANDIN!",
                recovery_mode: "KURTARMA MODU!",
                system_active: "Sƒ∞STEM AKTƒ∞F",
                copied: "Kopyalandƒ±!",
                saved: "Kaydedildi!",
                saving: "KAYDEDƒ∞Lƒ∞YOR...",
                loading: "Y√ºkleniyor...",
                fetch_error: "Veri alƒ±namadƒ±.",
                db_error: "Baƒülantƒ± hatasƒ±!",
                enter_name_alert: "L√ºtfen bir isim girin.",
                share_title: "Neon Leap üöÄ",
                share_score: "Skor:",
                paused: "DURAKLATILDI",
                resume: "DEVAM ET",
                quit: "√áIKI≈û"
            },
            en: {
                start_subtitle_1: "üî• FAST PLAY (Combo)",
                start_subtitle_2: "üõ°Ô∏è 3 COMBOS = 1 SHIELD",
                btn_start: "LAUNCH",
                game_over_title: "MISSION FAILED",
                mission_report: "MISSION REPORT",
                best_score: "BEST:",
                btn_share: "üì§ SHARE",
                enter_name: "ENTER NAME FOR LEADERBOARD:",
                placeholder_name: "PILOT NAME",
                btn_save: "SAVE",
                btn_retry: "RETRY",
                leaderboard_title: "üèÜ TOP 10 PILOTS",
                btn_close: "CLOSE",
                level_up: "LEVEL UP!",
                combo_x: "COMBO x",
                combo_broken: "COMBO BROKEN",
                shield_gained: "SHIELD GAINED!",
                recovery_mode: "RECOVERY MODE!",
                system_active: "SYSTEM ACTIVE",
                copied: "Copied!",
                saved: "Saved!",
                saving: "SAVING...",
                loading: "Loading...",
                fetch_error: "Fetch error.",
                db_error: "Connection error!",
                enter_name_alert: "Please enter a name.",
                share_title: "Neon Leap üöÄ",
                share_score: "Score:",
                paused: "PAUSED",
                resume: "RESUME",
                quit: "QUIT"
            }
        };
        const userLang = navigator.language || navigator.userLanguage; 
        const langCode = userLang.startsWith('tr') ? 'tr' : 'en'; 
        const T = TRANSLATIONS[langCode];
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(T[key]) el.innerText = T[key];
            });
            document.getElementById('player-name').placeholder = T.placeholder_name;
            document.getElementById('pause-screen').querySelector('h1').innerText = T.paused;
            document.getElementById('resume-btn').innerText = T.resume;
            document.getElementById('quit-btn').innerText = T.quit;
        });
    </script>

    <!-- FIREBASE -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";

        const firebaseConfig = {
          apiKey: "AIzaSyCc4ERyMGvfAXF-dh_PRztFH707_9pKca0",
          authDomain: "neonleap-2bb89.firebaseapp.com",
          projectId: "neonleap-2bb89",
          storageBucket: "neonleap-2bb89.firebasestorage.app",
          messagingSenderId: "653143256534",
          appId: "1:653143256534:web:a92cc76688072e427bc877",
          measurementId: "G-9YQEJ7LN0E"
        };

        let db;
        try { 
            const app = initializeApp(firebaseConfig); 
            const analytics = getAnalytics(app); 
            db = getFirestore(app); 
        } catch(e){ console.error(e); }

        async function saveScoreToDB(name, score) {
            if (!db) return alert(T.db_error);
            if (!name) return alert(T.enter_name_alert);
            const btn = document.getElementById('save-score-btn');
            btn.innerText = T.saving; btn.disabled = true;
            try {
                await addDoc(collection(db, "scores"), { name: name.toUpperCase(), score: score, date: new Date() });
                showToast(T.saved);
                document.getElementById('save-score-area').style.display = 'none';
                localStorage.setItem('neon_last_name', name);
                document.getElementById('leaderboard-screen').classList.remove('hidden');
                await fetchLeaderboard();
            } catch (e) { alert("Error: " + e.message); } finally { btn.innerText = T.btn_save; btn.disabled = false; }
        }

        async function fetchLeaderboard() {
            if (!db) return;
            const div = document.getElementById('leaderboard-content');
            div.innerHTML = `<div class="loading">${T.loading}</div>`;
            try {
                const q = query(collection(db, "scores"), orderBy("score", "desc"), limit(10));
                const snap = await getDocs(q);
                let html = '<ul class="leaderboard-list">';
                let i=1; snap.forEach(d => { html += `<li class="leaderboard-item"><span>#${i++} ${d.data().name}</span><span>${d.data().score}</span></li>`; });
                html += '</ul>';
                div.innerHTML = snap.empty ? "No Data" : html;
            } catch (e) { div.innerText = T.fetch_error; }
        }

        document.getElementById('save-score-btn').addEventListener('click', ()=>{ saveScoreToDB(document.getElementById('player-name').value, window.gameScore); });
        document.getElementById('show-leaderboard-btn').addEventListener('click', ()=>{ document.getElementById('leaderboard-screen').classList.remove('hidden'); fetchLeaderboard(); });
        document.getElementById('close-leaderboard-btn').addEventListener('click', ()=>{ document.getElementById('leaderboard-screen').classList.add('hidden'); });
        const saved = localStorage.getItem('neon_last_name'); if(saved) document.getElementById('player-name').value = saved;
    </script>

    <!-- OYUN MOTORU -->
    <script>
        // --- GLOBAL DURUMLAR ---
        let gameHistory = [];
        const HISTORY_LIMIT = 10;
        
        // MARKET Sƒ∞STEMƒ∞ (D√úZELTƒ∞LDƒ∞)
        let totalCredits = parseInt(localStorage.getItem('neonLeapCredits') || '0');
        let currentSkin = localStorage.getItem('neonLeapSkin') || 'default';
        // Sahip olunan skinleri JSON dizisi olarak saklƒ±yoruz
        let ownedSkins = JSON.parse(localStorage.getItem('neonOwnedSkins')) || ['default'];
        
        const SKINS = [
            { id: 'default', name: 'Neon White', cost: 0, color: '#ffffff' },
            { id: 'gold', name: 'Golden Legend', cost: 100, color: '#ffd700' },
            { id: 'cyber', name: 'Cyber Pink', cost: 250, color: '#ff00ff' },
            { id: 'ghost', name: 'Ghost Blue', cost: 500, color: '#00ffff' },
            { id: 'red', name: 'Red Fury', cost: 1000, color: '#ff0000' }
        ];

        function updateCreditsDisplay() {
            document.getElementById('total-credits').innerText = totalCredits;
            document.getElementById('shop-credits').innerText = totalCredits;
        }

        function addCredits(amount) {
            totalCredits += amount;
            localStorage.setItem('neonLeapCredits', totalCredits);
            updateCreditsDisplay();
            spawnFloatingText(width/2, 120, `+${amount} üü°`, "#ffd700");
        }

        // --- MARKET UI RENDER (FIX) ---
        function renderShop() {
            const grid = document.getElementById('shop-grid');
            grid.innerHTML = '';
            SKINS.forEach(skin => {
                const isOwned = ownedSkins.includes(skin.id);
                const isSelected = currentSkin === skin.id;
                
                const item = document.createElement('div');
                item.className = `shop-item ${isSelected ? 'selected' : ''}`;
                item.innerHTML = `
                    <div class="shop-item-preview">
                        <div class="preview-ship" style="border-bottom-color: ${skin.color}; filter: drop-shadow(0 0 5px ${skin.color})"></div>
                    </div>
                    <div style="font-weight:bold; font-size:0.8rem; margin-bottom:5px;">${skin.name}</div>
                    <div class="${isOwned ? (isSelected ? 'shop-active-text' : 'shop-owned') : 'shop-price'}">
                        ${isOwned ? (isSelected ? 'SE√áƒ∞Lƒ∞' : 'SAHƒ∞P OLUNDU') : skin.cost + ' üü°'}
                    </div>
                `;
                
                item.onclick = () => buyOrSelectSkin(skin, isOwned);
                grid.appendChild(item);
            });
        }

        function buyOrSelectSkin(skin, isOwned) {
            if (isOwned) {
                currentSkin = skin.id;
                localStorage.setItem('neonLeapSkin', currentSkin);
                renderShop();
                AudioSys.playSFX('dock');
            } else {
                if (totalCredits >= skin.cost) {
                    if(confirm(`${skin.cost} Kredi harcansƒ±n mƒ±?`)) {
                        totalCredits -= skin.cost;
                        localStorage.setItem('neonLeapCredits', totalCredits);
                        
                        ownedSkins.push(skin.id);
                        localStorage.setItem('neonOwnedSkins', JSON.stringify(ownedSkins));
                        
                        currentSkin = skin.id;
                        localStorage.setItem('neonLeapSkin', currentSkin);
                        
                        updateCreditsDisplay();
                        renderShop();
                        AudioSys.playSFX('levelup');
                        showToast("SATIN ALINDI!");
                    }
                } else {
                    showToast("YETERSƒ∞Z KREDƒ∞!");
                }
            }
        }

        function logHistory(emoji) {
            gameHistory.push(emoji);
            if(gameHistory.length > HISTORY_LIMIT) gameHistory.shift();
        }

        const THEMES = [
            { score: 0,  name: "SECTOR 1", bg: "#020204", main: "#00f2ff", sec: "#00ff9d" },
            { score: 10, name: "SECTOR 2", bg: "#1a001a", main: "#ff00ff", sec: "#aa00ff" },
            { score: 25, name: "SECTOR 3", bg: "#1a0a00", main: "#ff5500", sec: "#ffaa00" },
            { score: 40, name: "THE VOID", bg: "#000000", main: "#ffffff", sec: "#555555" }
        ];
        let currentThemeIdx = 0;

        function spawnFloatingText(x, y, text, color) {
            const el = document.createElement('div');
            el.className = 'floating-text'; el.innerText = text;
            el.style.left = x + 'px'; el.style.top = y + 'px'; el.style.color = color;
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1200);
        }

        function triggerLevelUp(idx) {
            const theme = THEMES[idx];
            document.body.style.backgroundColor = theme.bg;
            document.getElementById('score').style.color = theme.main;
            document.getElementById('level-txt').innerText = theme.name;
            const msg = document.getElementById('level-up-msg');
            msg.innerText = T.level_up; msg.style.color = theme.main;
            msg.classList.remove('levelup-anim'); void msg.offsetWidth; msg.classList.add('levelup-anim');
            AudioSys.playSFX('levelup');
        }

        // --- BOSS MANTIƒûI ---
        const BOSS = {
            active: false, y: -1000, speed: 0, warningShown: false,
            reset: function() { this.active=false; this.y=height+100; this.warningShown=false; document.body.classList.remove('shake-screen'); document.getElementById('boss-warning').classList.remove('boss-anim'); },
            check: function() {
                // Her 30 puanda bir (30, 60, 90...)
                if (score > 0 && score % 30 === 0 && !this.active && !this.warningShown) {
                    this.startWarning();
                }
            },
            startWarning: function() {
                this.warningShown = true;
                const w = document.getElementById('boss-warning');
                w.classList.add('boss-anim');
                AudioSys.playSFX('die'); // Siren sesi niyetine
                setTimeout(() => {
                    w.classList.remove('boss-anim');
                    this.startEncounter();
                }, 3000);
            },
            startEncounter: function() {
                this.active = true;
                this.y = height + 100; // Alttan ba≈üla
                this.speed = 2 + (score * 0.05); // Skor arttƒ±k√ßa hƒ±zlan
                document.body.classList.add('shake-screen');
            },
            update: function() {
                if(!this.active) return;
                this.y -= this.speed; // Yukarƒ± √ßƒ±k
                
                // Ekranƒ± ge√ßtiyse (Oyuncu kazandƒ±)
                if(this.y < -500) {
                    this.reset();
                    addCredits(20); // Boss √ñd√ºl√º
                    spawnFloatingText(width/2, height/2, "BOSS ATLATILDI! +20 üü°", "#ffd700");
                }
            },
            draw: function() {
                if(!this.active) return;
                // Kƒ±rmƒ±zƒ± Lazer Dalgasƒ± √áizimi
                let grad = ctx.createLinearGradient(0, this.y, 0, this.y + 400);
                grad.addColorStop(0, 'rgba(255, 0, 0, 0.8)');
                grad.addColorStop(1, 'rgba(255, 0, 0, 0)');
                ctx.fillStyle = grad;
                ctx.fillRect(0, this.y, width, 400);
                // Lazer √ßizgisi
                ctx.strokeStyle = '#ff0000'; ctx.lineWidth = 5;
                ctx.beginPath(); ctx.moveTo(0, this.y); ctx.lineTo(width, this.y); ctx.stroke();
            }
        };

        const AudioSys = {
            ctx: null, tempo: 100, isMusicOn: true, isSfxOn: true, beatCount: 0, timerID: null,
            scale: [130.81, 155.56, 174.61, 196.00, 233.08, 261.63],
            bassScale: [65.41, 77.78, 87.31, 98.00],
            init: function() { try { const AC = window.AudioContext || window.webkitAudioContext; if(AC && !this.ctx) this.ctx = new AC(); if(this.ctx.state === 'suspended') this.ctx.resume(); } catch(e){} },
            scheduleNextBeat: function() {
                if (!this.isMusicOn || gameState !== 'PLAYING') return;
                const secondsPerBeat = 60.0 / this.tempo;
                const secondsPer16th = secondsPerBeat / 4;
                this.playBeat(this.ctx.currentTime, this.beatCount);
                this.beatCount = (this.beatCount + 1) % 16; 
                this.timerID = setTimeout(() => this.scheduleNextBeat(), secondsPer16th * 1000);
            },
            updateTempo: function() { this.tempo = Math.min(160, 100 + (score * 1.5)); },
            playBeat: function(time, step) {
                this.updateTempo();
                if (step % 4 === 0) this.playDrum(time, 100, 'kick');
                if (score > 10 && step % 2 !== 0) this.playDrum(time, 800, 'hat');
                if (score > 5) { let noteIdx = Math.floor(step / 4) % this.bassScale.length; if (step % 2 === 0) this.playSynth(time, this.bassScale[noteIdx], 'sawtooth', 0.15, 0.1); }
                if (score > 20 && Math.random() > 0.6 && step % 2 === 0) { let note = this.scale[Math.floor(Math.random() * this.scale.length)]; this.playSynth(time, note * 2, 'square', 0.05, 0.1); }
            },
            startMusic: function() { if (this.timerID) clearTimeout(this.timerID); this.beatCount = 0; this.tempo = 100; this.scheduleNextBeat(); },
            stopMusic: function() { if (this.timerID) clearTimeout(this.timerID); },
            toggleMusic: function() { this.isMusicOn = !this.isMusicOn; document.getElementById('music-btn').classList.toggle('audio-off', !this.isMusicOn); if(this.isMusicOn && gameState==='PLAYING') this.startMusic(); else this.stopMusic(); },
            toggleSfx: function() { this.isSfxOn = !this.isSfxOn; document.getElementById('sfx-btn').classList.toggle('audio-off', !this.isSfxOn); },
            playDrum: function(time, freq, type) { if (!this.ctx) return; const osc = this.ctx.createOscillator(); const gain = this.ctx.createGain(); osc.connect(gain); gain.connect(this.ctx.destination); if (type === 'kick') { osc.frequency.setValueAtTime(freq, time); osc.frequency.exponentialRampToValueAtTime(0.01, time + 0.5); gain.gain.setValueAtTime(0.5, time); gain.gain.exponentialRampToValueAtTime(0.01, time + 0.5); } else if (type === 'hat') { osc.type = 'square'; osc.frequency.setValueAtTime(freq, time); gain.gain.setValueAtTime(0.05, time); gain.gain.exponentialRampToValueAtTime(0.01, time + 0.05); } osc.start(time); osc.stop(time + 0.5); },
            playSynth: function(time, freq, type, vol, dur) { if (!this.ctx) return; const osc = this.ctx.createOscillator(); const gain = this.ctx.createGain(); osc.connect(gain); gain.connect(this.ctx.destination); osc.type = type; osc.frequency.setValueAtTime(freq, time); gain.gain.setValueAtTime(0, time); gain.gain.linearRampToValueAtTime(vol, time + 0.02); gain.gain.exponentialRampToValueAtTime(0.01, time + dur); osc.start(time); osc.stop(time + dur); },
            playSFX: function(type) {
                if(!this.ctx || !this.isSfxOn) return; const t = this.ctx.currentTime; const o = this.ctx.createOscillator(); const g = this.ctx.createGain(); o.connect(g); g.connect(this.ctx.destination);
                if(type==='dock') { o.type='triangle'; o.frequency.setValueAtTime(300, t); o.frequency.exponentialRampToValueAtTime(50, t+0.15); g.gain.setValueAtTime(0.1, t); g.gain.linearRampToValueAtTime(0, t+0.15); o.start(t); o.stop(t+0.15); }
                else if(type==='jump') { o.type='sawtooth'; o.frequency.setValueAtTime(100, t); o.frequency.linearRampToValueAtTime(400, t+0.3); g.gain.setValueAtTime(0.1, t); g.gain.exponentialRampToValueAtTime(0.01, t+0.3); o.start(t); o.stop(t+0.3); }
                else if(type==='combo') { o.type='sine'; o.frequency.setValueAtTime(600, t); o.frequency.exponentialRampToValueAtTime(1200, t+0.2); g.gain.setValueAtTime(0.2, t); g.gain.linearRampToValueAtTime(0, t+0.2); o.start(t); o.stop(t+0.2); }
                else if(type==='shield_get') { o.type='square'; o.frequency.setValueAtTime(400, t); o.frequency.linearRampToValueAtTime(800, t+0.4); g.gain.setValueAtTime(0.1, t); g.gain.linearRampToValueAtTime(0, t+0.4); o.start(t); o.stop(t+0.4); }
                else if(type==='recover') { o.type='sawtooth'; o.frequency.setValueAtTime(100, t); o.frequency.linearRampToValueAtTime(300, t+1.0); g.gain.setValueAtTime(0.2, t); g.gain.linearRampToValueAtTime(0, t+1.0); o.start(t); o.stop(t+1.0); }
                else if(type==='die') { o.type='sawtooth'; o.frequency.setValueAtTime(80, t); o.frequency.linearRampToValueAtTime(20, t+0.8); g.gain.setValueAtTime(0.4, t); g.gain.linearRampToValueAtTime(0, t+0.8); o.start(t); o.stop(t+0.8); }
                else if(type==='levelup') { o.type='square'; o.frequency.setValueAtTime(200, t); o.frequency.linearRampToValueAtTime(800, t+0.5); g.gain.setValueAtTime(0.1, t); g.gain.linearRampToValueAtTime(0, t+0.5); o.start(t); o.stop(t+0.5); }
            }
        };

        class Star {
            constructor() { this.reset(true); }
            reset(r=false) { this.x=Math.random()*width; this.y=r?Math.random()*height:-10; this.z=Math.random()*2+0.5; this.a=Math.random()*0.5+0.1; }
            update() { this.y+=this.z*(0.5+(score*0.02)); if(this.y>height) this.reset(); }
            draw() { ctx.fillStyle=`rgba(255,255,255,${this.a})`; ctx.beginPath(); ctx.arc(this.x, this.y, this.z*0.8, 0, 6.28); ctx.fill(); }
        }

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d', { alpha: false });
        let width, height, gameState='MENU';
        let score=0, shields=0, cameraY=0, comboCount=0;
        let player, orbs=[], stars=[];
        window.gameScore = 0;

        class Player {
            constructor() { this.reset(); }
            reset() { this.x = width/2; this.y = height-200; this.vx=0; this.vy=0; this.radius=15; this.orbiting=true; this.currentOrb=null; this.angle=-Math.PI/2; this.trail=[]; this.attachTime=0; }
            update() {
                if(Math.random()>0.5) this.trail.push({x:this.x, y:this.y, l:1});
                this.trail.forEach(t=>t.l-=0.1); this.trail=this.trail.filter(t=>t.l>0);
                
                if(gameState==='RECOVERING') {
                     let target = null, minD = 99999;
                     orbs.forEach(o => { let d = Math.hypot(o.x - this.x, o.y - this.y); if(d < minD) { minD = d; target = o; } });
                     if(!target && orbs.length > 0) target = orbs[orbs.length-1];
                     if(target) {
                         this.x += (target.x - this.x) * 0.15; this.y += (target.y - this.y) * 0.15;
                         if(Math.hypot(target.x - this.x, target.y - this.y) < target.rad + 20) { 
                             attachPlayer(target); gameState='PLAYING'; spawnFloatingText(width/2, height/2, T.system_active, "#00ff9d"); 
                         }
                     }
                     return;
                }

                if(this.orbiting && this.currentOrb) {
                    let speed = 0.04 + (score*0.0005); if(speed>0.1) speed=0.1;
                    this.angle += speed * this.currentOrb.dir;
                    this.x = this.currentOrb.x + Math.cos(this.angle)*this.currentOrb.rad;
                    this.y = this.currentOrb.y + Math.sin(this.angle)*this.currentOrb.rad;
                    this.rotation = this.angle + Math.PI/2*this.currentOrb.dir;
                } else {
                    this.x+=this.vx; this.y+=this.vy;
                    if(Math.abs(this.vx)>0.1 || Math.abs(this.vy)>0.1) this.rotation = Math.atan2(this.vy, this.vx);
                    
                    // BOSS √áARPI≈ûMASI KONTROL√ú
                    if(BOSS.active && this.y > BOSS.y) {
                        if(shields>0) trySavePlayer(); else gameOver();
                    }

                    if(this.x<-50 || this.x>width+50 || this.y>cameraY+height+100 || this.y<cameraY-500) {
                        trySavePlayer();
                    }
                }
            }
            draw() {
                let dy=this.y-cameraY;
                let currentTheme = THEMES[currentThemeIdx];
                let skin = SKINS.find(s => s.id === currentSkin) || SKINS[0];
                let trailColor = gameState==='RECOVERING' ? '#00ff9d' : skin.color;

                ctx.beginPath(); this.trail.forEach(t=>ctx.lineTo(t.x, t.y-cameraY)); ctx.strokeStyle=trailColor; ctx.lineWidth=2; ctx.stroke();
                ctx.save(); ctx.translate(this.x, dy); ctx.rotate(this.rotation);
                if(shields>0 && gameState==='PLAYING') { ctx.beginPath(); ctx.arc(0,0,25,0,6.28); ctx.strokeStyle=`rgba(0,255,157,${0.3+Math.sin(Date.now()*0.01)*0.2})`; ctx.lineWidth=2; ctx.stroke(); }
                
                ctx.beginPath(); ctx.moveTo(15,0); ctx.lineTo(-10,10); ctx.lineTo(-5,0); ctx.lineTo(-10,-10); 
                ctx.fillStyle = skin.color; ctx.fill();
                ctx.restore();
            }
            jump() {
                if(this.orbiting) {
                    let timeSpent = Date.now() - this.attachTime;
                    if (timeSpent < 1500 && timeSpent > 50) {
                        comboCount++;
                        logHistory('üî•'); 
                        if(comboCount < 3) {
                            AudioSys.playSFX('combo');
                            spawnFloatingText(this.x, this.y - 50, `${T.combo_x}${comboCount}`, "#ffaa00");
                            addCredits(2);
                        } else if (comboCount === 3) {
                            shields++; 
                            document.getElementById('shield-count').innerText=shields;
                            const sUI = document.getElementById('shield-ui'); sUI.classList.add('shield-active'); setTimeout(()=>sUI.classList.remove('shield-active'), 500);
                            spawnFloatingText(this.x, this.y - 80, T.shield_gained, "#00ff9d");
                            AudioSys.playSFX('shield_get');
                            comboCount = 0;
                            addCredits(10);
                        }
                    } else {
                        logHistory('üîµ');
                        if(comboCount > 0) spawnFloatingText(this.x, this.y - 50, T.combo_broken, "#ff5555");
                        comboCount = 0;
                    }
                    this.orbiting=false;
                    let p = 13 + score*0.05; if(p>22) p=22;
                    this.vx = Math.cos(this.rotation)*p; this.vy = Math.sin(this.rotation)*p;
                    AudioSys.playSFX('jump');
                }
            }
        }

        class Orb {
            constructor(y) { 
                this.y=y; this.rad=60+Math.random()*20; this.x=Math.random()*(width-this.rad*2)+this.rad; 
                this.dir=Math.random()>0.5?1:-1; 
                this.moving = false; this.shrinking = false;
                this.dx = (Math.random() * 1.5 + 0.5) * (Math.random()>0.5?1:-1);
                if(score >= 10) this.moving = Math.random() > 0.4;
                if(score >= 25) this.shrinking = Math.random() > 0.5;
            }
            update() {
                if(gameState !== 'PLAYING') return;
                if(this.moving) { this.x += this.dx; if(this.x < this.rad || this.x > width - this.rad) this.dx *= -1; }
                if(this.shrinking && this.rad > 25) this.rad -= 0.05;
            }
            draw() { 
                let dy=this.y-cameraY; if(dy<-200||dy>height+200) return; 
                let theme = THEMES[currentThemeIdx];
                let pulse = Math.sin(Date.now() * 0.005) * 2;
                ctx.beginPath(); ctx.arc(this.x, dy, this.rad + pulse, 0, 6.28); ctx.strokeStyle='#333'; ctx.lineWidth=3; ctx.stroke(); 
                ctx.beginPath(); ctx.arc(this.x, dy, this.rad-5 + pulse, 0, 6.28); ctx.strokeStyle=theme.main; ctx.lineWidth=1; ctx.stroke(); 
                if(this.shrinking) { ctx.fillStyle='#ff0000'; ctx.beginPath(); ctx.arc(this.x, dy, 3, 0, 6.28); ctx.fill(); }
            }
        }

        function init() {
            width=window.innerWidth; height=window.innerHeight; canvas.width=width; canvas.height=height;
            player=new Player(); score=0; shields=0; comboCount=0; orbs=[]; stars=[]; window.gameScore=0; currentThemeIdx=0;
            BOSS.reset();
            gameHistory = [];
            for(let i=0; i<100; i++) stars.push(new Star());
            let start=new Orb(height-200); start.x=width/2; start.moving=false; start.shrinking=false; orbs.push(start);
            player.orbiting=true; player.currentOrb=start; player.angle=-Math.PI/2; 
            player.x = start.x; player.y = start.y - start.rad; player.attachTime = Date.now();
            cameraY=player.y-height/1.5; generateOrbs();
            document.getElementById('score').innerText=0; document.getElementById('shield-count').innerText=0;
            updateThemeUI();
            updateCreditsDisplay();
        }

        function attachPlayer(o) { player.orbiting=true; player.currentOrb=o; player.angle=Math.atan2(player.y-o.y, player.x-o.x); player.attachTime = Date.now(); AudioSys.playSFX('dock'); }
        function generateOrbs() { let lastY=orbs.length>0?orbs[orbs.length-1].y:height; while(lastY > cameraY-height) { lastY-=250; orbs.push(new Orb(lastY)); } if(orbs[0].y-cameraY > height+400) orbs.shift(); }
        
        function updateThemeUI() {
            const theme = THEMES[currentThemeIdx];
            document.body.style.backgroundColor = theme.bg;
            document.getElementById('score').style.color = theme.main;
            document.getElementById('level-txt').innerText = theme.name;
        }

        function checkCols() { 
            if(player.orbiting) return; 
            orbs.forEach(o => { 
                if(Math.hypot(player.x-o.x, player.y-o.y) < o.rad) { 
                    if(player.currentOrb!==o) { 
                        attachPlayer(o); 
                        score++; window.gameScore=score; 
                        addCredits(1);
                        document.getElementById('score').innerText=score; 
                        
                        BOSS.check(); // Boss kontrol√º

                        let nextIdx = currentThemeIdx + 1;
                        if(nextIdx < THEMES.length && score >= THEMES[nextIdx].score) { currentThemeIdx = nextIdx; triggerLevelUp(currentThemeIdx); }
                    } 
                } 
            }); 
        }
        
        function trySavePlayer() {
            if(shields>0) {
                shields--; document.getElementById('shield-count').innerText=shields;
                AudioSys.playSFX('recover'); logHistory('üõ°Ô∏è');
                gameState='RECOVERING'; player.vx=0; player.vy=0;
                spawnFloatingText(width/2, height/2, T.recovery_mode, "#00ff9d");
                BOSS.reset(); // Kurtulursa Boss gider
            } else { gameOver(); }
        }

        function gameOver() {
            gameState='GAMEOVER'; AudioSys.stopMusic(); AudioSys.playSFX('die');
            logHistory('üíÄ');
            let historyStr = gameHistory.slice(-10).join('');
            document.getElementById('share-preview').innerText = historyStr;
            let personalBest = localStorage.getItem('neonLeapBest') || 0;
            if (score > personalBest) { personalBest = score; localStorage.setItem('neonLeapBest', personalBest); }
            document.getElementById('final-score').innerText = score;
            document.getElementById('best-score').innerText = personalBest;
            document.getElementById('game-over-screen').classList.remove('hidden');
            document.getElementById('save-score-area').style.display = 'block';
        }

        function copyToClipboard() {
            let historyStr = gameHistory.slice(-10).join('');
            let text = `${T.share_title}\n${historyStr}\n${T.share_score} ${score}`;
            const textArea = document.getElementById("clipboard-helper");
            textArea.value = text; textArea.select();
            try { document.execCommand("copy"); showToast(T.copied); } catch (err) {}
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) { document.documentElement.requestFullscreen(); } 
            else { if (document.exitFullscreen) document.exitFullscreen(); }
        }

        function togglePause() {
            if (gameState === 'PLAYING') {
                gameState = 'PAUSED';
                document.getElementById('pause-screen').classList.remove('hidden');
                AudioSys.stopMusic();
            } else if (gameState === 'PAUSED') {
                gameState = 'PLAYING';
                document.getElementById('pause-screen').classList.add('hidden');
                if (AudioSys.isMusicOn) AudioSys.startMusic();
            }
        }

        function loop() {
            if (gameState === 'PAUSED') { requestAnimationFrame(loop); return; }
            ctx.fillStyle=THEMES[currentThemeIdx].bg; ctx.fillRect(0,0,width,height);
            stars.forEach(s => { s.update(); s.draw(); });
            if(gameState==='PLAYING' || gameState==='RECOVERING') { player.update(); let tCam = player.y - height/1.8; if(tCam<cameraY) cameraY+=(tCam-cameraY)*0.1; if(gameState==='PLAYING') { generateOrbs(); checkCols(); } }
            
            BOSS.update();
            BOSS.draw(); // Arkada kalsƒ±n diye playerdan √∂nce

            orbs.forEach(o => { o.update(); o.draw(); });
            if(gameState === 'RECOVERING') {
                let target = orbs.find(o => Math.hypot(o.x - player.x, o.y - player.y) < 800) || orbs[orbs.length-1];
                if(target) {
                    ctx.beginPath(); ctx.moveTo(player.x, player.y-cameraY); ctx.lineTo(target.x, target.y-cameraY);
                    ctx.setLineDash([15, 15]); ctx.strokeStyle = '#00ff9d'; ctx.lineWidth = 4; ctx.stroke(); ctx.setLineDash([]);
                }
            }
            player.draw();
            if(gameState!=='GAMEOVER') requestAnimationFrame(loop);
        }

        document.getElementById('start-btn').addEventListener('click', ()=>{ AudioSys.init(); AudioSys.startMusic(); init(); gameState='PLAYING'; document.getElementById('start-screen').classList.add('hidden'); loop(); });
        document.getElementById('restart-btn').addEventListener('click', ()=>{ document.getElementById('game-over-screen').classList.add('hidden'); init(); gameState='PLAYING'; AudioSys.startMusic(); loop(); });
        document.getElementById('share-btn').addEventListener('click', copyToClipboard);
        document.getElementById('music-btn').addEventListener('click', (e) => { e.stopPropagation(); AudioSys.toggleMusic(); });
        document.getElementById('sfx-btn').addEventListener('click', (e) => { e.stopPropagation(); AudioSys.toggleSfx(); });
        document.getElementById('fullscreen-btn').addEventListener('click', (e) => { e.stopPropagation(); toggleFullScreen(); });
        document.getElementById('pause-btn').addEventListener('click', (e) => { e.stopPropagation(); togglePause(); });
        document.getElementById('resume-btn').addEventListener('click', (e) => { e.stopPropagation(); togglePause(); });
        document.getElementById('quit-btn').addEventListener('click', (e) => { location.reload(); });
        document.getElementById('shop-btn').addEventListener('click', (e) => { e.stopPropagation(); renderShop(); document.getElementById('shop-screen').classList.remove('hidden'); });
        document.getElementById('close-shop-btn').addEventListener('click', (e) => { document.getElementById('shop-screen').classList.add('hidden'); });

        window.addEventListener('mousedown', e=>{ if(e.target.tagName!=='BUTTON' && e.target.tagName!=='INPUT') if(gameState==='PLAYING') player.jump(); });
        window.addEventListener('touchstart', e=>{ if(e.target.tagName!=='BUTTON' && e.target.tagName!=='INPUT') {e.preventDefault(); if(gameState==='PLAYING') player.jump();} }, {passive:false});
        window.addEventListener('resize', ()=>{width=window.innerWidth; height=window.innerHeight; canvas.width=width; canvas.height=height;});
        
        function showToast(msg) { const t = document.getElementById('toast'); t.innerText=msg; t.classList.add('show-toast'); setTimeout(()=>t.classList.remove('show-toast'), 2000); }
        updateCreditsDisplay();
    </script>
</body>
</html>